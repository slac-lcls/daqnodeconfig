---
- hosts: "wave8_drp"    # timing_high, wave8_drp,camlink_drp,hsd_drp
  become: false       #do not use root
  gather_facts: false
  ignore_errors: true
  check_mode: false    #failsafe, set to false if you want to run it
  serial: 1
  vars:
    filepath:      "~psrel/git/daqnodeconfig/mcs/drp/"
    firmw:         "XilinxKcu1500Pgp4_6Gbps-0x02050000-20240215192118-ruckman-3e991ff_*.mcs_primary.mcs"
    setup_source:  "source ~tmoopr/daq/setup_env.sh"
    cd_cameralink: "cd ~psrel/git/pgp-pcie-apps/software/"
    

  tasks:
  - name: "update firmware"
    shell:
    args:
      cmd: nohup xterm -hold -T {{ inventory_hostname }} -e "bash -c '{{ setup_source }} ; {{ cd_cameralink }} ; python ./scripts/nodePcieFpga.py --dev /dev/datadev_0  --filename {{ filepath }}{{ firmw }} '" </dev/null >/dev/null 2>&1 &
      executable: /bin/bash  


